PrimoGENI Constellation for Hybrid At-Scale Network Experimentation on GENI Resources 
=====================================================================================

*---THIS PAGE IS HEAVILY UNDER CONSTRUCTION---*

PrimoGENI Constellation allows large-scale network experiments consisting of simulated and emulated components running real applications on GENI resources (www.geni.net). Network traffic generated by the applications is conducted on the virtual network and subjected to packet delays and losses in accordance with the simulated network conditions.

## Prepare Installation 

The installation consists of three steps before running PrimoGENI Constellation on your local machine. (So far, we have successfully run PrimoGENI both on Ubuntu Linux and on Mac OS.) The steps are:
  1. Compiling `primex`, the real-time network simulator
  2. Installing `slingshot`, the graphical interface
  3. Creating runtime environments for running experiments on GENI slices

Slingshot and primex will run on your local host. Slingshot is an integrated development interface (IDE) used by experimenters to create network models, launch and monitor the experiments. Primex is a network simulator; it will be installed on your local machine, so that you candirectly run small-scale simulation-only experiments on your local machine. To run larger experiments with full simulation and emulation capabilities, you need to run experiments on preallocated GENI slices (such as those obtained through the geni portal at https://portal.geni.net/). PrimoGENI provides a set of pre-packaged OS images which the experimenters can choose to start their GENI slices. These OS images contain primex and other important facilities for managing network experiments and connecting them with slingshot running on your local machine in real time. Before using these GENI slices, you need to create the "runtime environments" in slingshot, so that slingshot can launch the experiments on the corresponding GENI slices. 

To install PrimoGENI, you need to have some packages installed on your local machine:
* Ubuntu Linux:
  1. `sudo apt-get update; sudo apt-get upgrade`
  2. `sudo apt-get install git subversion wget build-essential gcc python flex bison ant openjdk-6-jdk libpcap-dev texlive-binaries`
  3. `sudo update-alternatives --config javac` 
  4. Set the environment variable JAVA\_HOME; add the following command to your login shell (such as `~/.bash_profile` for bash):
    * For 32-bit Linux: `export JAVA_HOME=/usr/lib/jvm/java-6-openjdk-i386`
    * For 64-bit Linux: `export JAVA_HOME=/usr/lib/jvm/java-6-openjdk-amd64`
* Mac OS:
  1. Install latest MacPorts (https://www.macports.org/) and Xcode (https://developer.apple.com/xcode/downloads/)
  2. `sudo port selfupdate; sudo port upgrade outdated`
  3. `sudo port install git subversion wget python27 flex bison apache-ant`
  4. Install JDK 1.6 (if you don't already have; look into `/System/Library/Java/JavaVirtualMachines` directory). Go to https://developer.apple.com/downloads (you need an Apple account); download and install Java for OS X 2012-006 Developer Package.
  5. Set the environment variable JAVA\_HOME; add the following command to your login shell (such as `~/.bash_profile` for bash):
    * `export JAVA_HOME=$(/usr/libexec/java_home -v 1.6)` 


## Compile Primex

Primex is a real-time network simulator. One can directly download primex from github and use the provided script to build the simulator in one shot: 
  1. `git clone https://github.com/netsym/primogeni`
  2. `cd primogeni`
  3. `sh build_all.sh`

Note that building the simulator may take a few minutes.


## Install Slingshot

Slingshot is the graphical user interface that one uses to launch and control PrimoGENI experiments. Slingshot was developed using Eclipse RCP. Therefore, we need to install Eclipse for running slingshot:
  1. Download Eclipse. We use Eclipse Indigo for RCP and RAP developers, which can be obtained from http://www.eclipse.org/downloads/packages/eclipse-rcp-and-rap-developers/indigosr2 (For Mac OS, make sure you choose the 32- or 64-bit version compatible with your Java installation; find out using `java -version`).
  2. Untar the eclipse-\*.tar.gz file (the name depending on the version of Eclipse you use) under primogeni:<br>
    `cd primogeni; tar -xzf eclipse-*.tar.gz`
  3. Download the Afae plugin (for syntax highlighting):<br>
    `cd eclipse/plugins; wget --no-check-certificate https://www.primessf.net/primogeni/afae_plugins.tgz`
  4. `tar -xzf afae_plugins.tgz`
  5. Run Eclipse (you may need to set a directory for eclipse workspace)
  6. Create Slingshot project in Eclipse:
    1. Click on `File > New > Java Project` or `File > New > Project` and then select `Java > Java Project` in the `New Project` window
    2. Put `Slingshot` as `Project name`, uncheck `Use default location`, select `Location` to be the netIDE directory under the primogeni directory, and click `Finish`
    3. Configure Eclipse to use Java 1.6:
      * For Ubuntu Linux:
        * Right click on `Slingshot` project in the package explorer and select `Properties`
        * In the popup window, click on `Java Build Path` and select `Libraries` tab 
        * Select `JRE System library` and select `Edit...`
        * Select the corresponding JRE System Library:
          * Click `Installed JREs > Add > Standard VM` and `Next`
          * In `JRE home` field, enter the Java home directory: `/usr/lib/jvm/java-6-openjdk-...`
          * Choose a proper `JRE name` and click `Finish`
          * In the `Installed JREs` widget, select the newly added entry
      * For Mac OS (one can skip this step the default is Java 1.6; find out using `java -version`):
        * Right click on `Slingshot` project in the package explorer and select `Properties`
        * In the popup window, click on `Java Build Path` and select `Libraries` tab 
        * Select `JRE System library` and select `Edit...`
        * Select the `Execution environment` using the pulldown menu
    4. Help Eclipse to resolve plug-in dependencies:
      * Right click on `Slingshot` project in the package explorer and select `Properties`
      * In the popup window, click on `Java Build Path` and select `Libraries` tab 
      * Click `Add Libraries`, choose `Plug-in Dependencies`, click `Next` and then `Finish`
  7. Run slingshot:
    1. Expand the Slingshot project in the `Package Explorer`
    2. Open either `slingshot_linux_32.product`, `slingshot_linux_64.product`, or `slingshot_mac.product`, depending on your machine type
    3. Click `Launch an Eclipse application`
    4. When run for the first time, slingshot will ask you to set the workspace (manually, this can be done by selecting `File > Switch Workspace`); you can choose a new folder to store all your primogeni experiments
    5. Slingshot will also ask you to set preference; in particular, it will ask for the location of your primex installation (manually, this can be done by selecting `Tools > Slingshot Config Wizard`); simply enter the primogeni directory


## Prepare Runtime Environments

One needs to specify the runtime environment to launch experiments. PrimoGENI supports two types of runtime environments:
  * *Local Machine*: One can run an experiment can run on the same machine where Slingshot is located. Currently, local machine supports only simulation experiments, and they are typically small experiments. In its next version, PrimoGENI will allow hybrid experiments on the local machine with both simulated and emulated components. Note that one does not need to explicitly install the local machine runtime environment; it has already been created by default.
  * *GENI Slice*: The experiments can run on pre-allocated GENI slices, each consisted of at least two machines (or VMs) booted from an existing PrimoGENI OS image. The machines in the slice much be all connected through a LAN. Slingshot uses the "manifest rspec" (i.e., the xml description returned by the GENI experimenter tools upon resource allocation) as input to create a runtime environment. Currently, PrimoGENI supports experiments on ProtoGENI (www.protogeni.net), and both InstaGENI (http://groups.geni.net/geni/wiki/GENIRacksHome/InstageniRacks) and ExoGENI (www.exogeni.net) racks.

In the following, we discuss how to create the runtime environments for different GENI resources:
  * If you haven't already done so, you need to generate an ssh keypair in the `~/.ssh` directory (so that you will be able to log onto GENI slices without using passphrase):<br>
      `cd ~/.ssh`<br>
      `ssh-keygen -f id_geni_rsa_nopass`<br>
      `ssh-add id_geni_rsa_nopass`<br>
    You need to upload the public key (`id_geni_rsa_nopass.pub`) to the GENI portal (https://portal.geni.net); it's under `Profile` and `SSH Keys`.
  * Create the GENI slice. If you are new to GENI you can learn about using GENI from [here](http://groups.geni.net/geni/wiki/GENIExperimenterWelcome). One can create a GENI slice at the GENI portal (https://portal.geni.net) or using separate experimenter tools, such as Flack/Jacks, GENI Desktop, and Omni. Each slice must contain at least two machines connected by a LAN. Also, you need to specify the respective PrimoGENI OS image for the machines depending on the GENI resource type:
    * ExoGENI rack: the disk image's `Name` shall be `http://users.cis.fiu.edu/~mobai001/primogeni_exo_image/image_gec21.xml`; the  `Version` shall be `eb36bbf95d7d73b698e4ad24ea1064438f7f82da` (i.e., the sha1sum of the xml file). We recommend using the sliver type `XOMedium` or larger.
    * InstaGENI rack: the disk images depend on location (with names listed below). The sliver type should be `emulab-xen`.
      * Clemson University: `urn:publicid:IDN+instageni.clemson.edu+image+ch-geni-net:primov32instaclemson`
      * Northwestern University: `urn:publicid:IDN+instageni.northwestern.edu+image+ch-geni-net:primov3instanorthwestern`
      * University of Kentucky: `urn:publicid:IDN+instageni.ku.gpeni.net+image+ch-geni-net:primov31instclemson`
    * ProtoGENI: *TODO*
  * Save the the manifest rspec into a file which you will need for creating the runtime environment. (For example, if using Flack, one should be able to view the manifest document and then save it to a file).
  * In slingshot, `Experiment > Create/Edit Environments`, provide a `Name` for the new environment, select `Geni Slices`, and the click `Add`. In the popup window, click `Browse...` to select the manifest file, click `Add` and then `Finish` (three times).


*---LATER---*

  * Now its time to create an experiment in Slingshot. Follow this [link](http://users.cis.fiu.edu/~meraz001/primotutorial/getstarted.html) for getting started with model writing for Slingshot. This will show you the basics of creating, compiling, and running an experiment in Slingshot. 
A simple model that only contains simulated hosts and link can be run on Local simulator by compiling and running the experiment you just created.

  * For running the experiments on GENI resources you should select some of the hosts of your model as *emulated hosts*. To get the resources for running the model on Geni resources you need to get Geni resource slice (using Flack/Geni Desktop/Omni/geni portal). Allocate two machines (or vms) connected with a lan. Assign the lan interface an ipv4 IP like `10.10.1.1` and `10.10.1.2`. To be able to run Primogeni the OS image of these two sliver needs to have a **Primogeni OS image**. 

 


2. 
   3. OS IMAGE complete instageni site: KU.GPENI.NET
      * For the same manager, you can use id=
      * For other managers, you can use url=https://www.instageni.ku.gpeni.net/image_metadata.php?uuid=37ea9fda-49ef-11e4-8f68-000000000000
   4. OS IMAGE complete instageni site: Gatech
      * For the same manager, you can use id=urn:publicid:IDN+instageni.ku.gpeni.net+image+ch-geni-net:primov3instaclemson
      * For other managers, you can use url=https://www.instageni.ku.gpeni.net/image_metadata.php?uuid=d01d7d72-49dc-11e4-8f68-000000000000
      * Comments: Tested Operational.

3. For: Protogeni
    1. Emulab.net
       * Image 1 


##### Creating a Hybrid Experiment on Slingshot
We have some saved models in `primogeni` project you cloned from github.  While your slice takes time to allocate resources lets create an experiment in Slingshot. To create an experiment, click on `File > New > Experiment` on the top menu bar of Slingshot. This will bring up a new window. `Name` the experiment With an experiment name and Browse for the model file. Navigate to the primogeni directory(The one you cloned from git). Go to `netscript/test/java_models` and select `MyThirdJavaModel.java` the click `ok`. Click `finish` to create the experiment. Now double-click on the experiment to see the visualization of the model on Slingshot. You can `increase/decrese` view depth on right to adjust On the right of the Slingshot to view the details of the nested subnets.  
 
##### Compiling The Model
To compile the model, click on `Experiment > Compile Experiment` on the top menu bar. Your experiment is compiled.

##### Adding a Slingshot Environment for Deploying Model
I am assuming  enough time has passed and our slivers that we were creating are allocated and ready to do use. Hosts generally turn green in Flack once they are up and ready to use. 
   * Save the manifest rspec from geni portal with a .rspec or .xml extension. 
   * Click on create a new environment button on the toolbar. 
   * Select `Progeni/Instageni/Exogeni` and Click `next`. Select which version is your rspec and then browse the Rspec file and click `add`. It will be listed for persing.
   * Now Select one of the slivers as `master` and rest of the slivers as `slave` for the experiment. Please refer to this to learn more about Primogeni Architecture. Click `next`. 
   * It will show you a summary about the master and slave nodes in the rspec
   * Environemt is added successfully.
   * Note: For creating Portal experiments (Special types of supported nodes in Primogeni that lets Primogeni slivers to connect to external network/internet), the resource allocation and environment creation need to be configured like differently.
   



##### Running The Model
One you have the model compiled and the environment created to support emulation you can now deploy your model and view/collect realtime experiment results. Click the `Play` button in the toolbar to run the model. It will ask you to `select the environment`. Select the environment where you want to deploy your experiment. (You can `use the environment you created in previous step`). Enter the `time` for how long you want to run the experiment. Hit `finish`. It will take few seconds based on the communication delay of the remote Geni machines for the experiment to start. In addition if there is any emulated hosts those will be created right before advancing the simulation time. Check the Slingshot Log if there is any isssues that might prevent your experimnent from deploying.


#### Primogeni COnstellation Mailing list
You can report the problems you  experience during the whole process at our mailing list. 
Our mailing list is: primogeni
